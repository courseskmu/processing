<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>More Complex Animations with State Variables &mdash; CMPT 166 Fall 2016 1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="CMPT 166 Fall 2016 1 documentation" href="index.html" />
    <link rel="next" title="Case Study: Watching Grass Grow" href="grass.html" />
    <link rel="prev" title="Simulating Water with a Particle System" href="sprite_water_sim.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="grass.html" title="Case Study: Watching Grass Grow"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sprite_water_sim.html" title="Simulating Water with a Particle System"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CMPT 166 Fall 2016 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">More Complex Animations with State Variables</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#the-main-program">The Main Program</a></li>
<li><a class="reference internal" href="#the-paratrooper-class">The Paratrooper Class</a></li>
<li><a class="reference internal" href="#a-note-on-efficiency">A Note on Efficiency</a></li>
<li><a class="reference internal" href="#questions">Questions</a></li>
<li><a class="reference internal" href="#source-code">Source Code</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sprite_water_sim.html"
                        title="previous chapter">Simulating Water with a Particle System</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="grass.html"
                        title="next chapter">Case Study: Watching Grass Grow</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="more-complex-animations-with-state-variables">
<h1>More Complex Animations with State Variables<a class="headerlink" href="#more-complex-animations-with-state-variables" title="Permalink to this headline">¶</a></h1>
<p>In these notes you will learn how to:</p>
<ul class="simple">
<li>Use a state variable to make an object do different things.</li>
<li>Use if-else-if statements in render/update functions to create complex
behavior.</li>
</ul>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to create an animation that shows little people
(paratroopers) drop from the top of the screen for a few moments, and then,
near the middle, suddenly open their parachutes and float gently to the
ground. On the ground, their parachutes disappear and theu walk left or right
along the bottom of the screen until they disappear through one of the edges.</p>
<p>What&#8217;s interesting about this example is that the paratroopers have three
distinct states that we will need to keep track of:</p>
<ul class="simple">
<li>The &#8220;falling&#8221; state, where they fall quickly downwards without a parachute.</li>
<li>The &#8220;floating&#8221; state, where they fall slowly downwards with a parachute.</li>
<li>The &#8220;walking&#8221; state, where they are walking, either towards the left or the
right, along the bottom of the screen.</li>
</ul>
<p>A paratroopers appearance and behavior depends on its state. We&#8217;ll use if-
statements inside the <code class="docutils literal"><span class="pre">render()</span></code> and <code class="docutils literal"><span class="pre">update()</span></code> functions to decide what
to do based upon the current state.</p>
<p>We will also need to manage <strong>state transitions</strong>. For our paratrooper, we
have the following state transitions:</p>
<ul class="simple">
<li><strong>falling</strong> <span class="math">\(\rightarrow\)</span> <strong>floating</strong>: When the paratrooper is
falling, it should change to <strong>floating</strong> after it has fallen some randomly-
chosen distance</li>
<li><strong>floating</strong> <span class="math">\(\rightarrow\)</span> <strong>walking</strong>: When the paratrooper is
floating, it should change to <strong>walking</strong> when it reaches the ground.</li>
<li><strong>walking</strong> <span class="math">\(\rightarrow\)</span> <strong>falling</strong>: When the paratrooper is
walking, it should change to <strong>falling</strong> after it has reached either the
left edge or right edge of the screen.</li>
</ul>
<p>When we change the state of the paratrooper, we may also perform other
actions. For instance, when the state changes from &#8220;walking&#8221; to &#8220;falling&#8221;, we
will move the paratrooper to the top of the screen and drop them again as if
they were brand new.</p>
</div>
<div class="section" id="the-main-program">
<h2>The Main Program<a class="headerlink" href="#the-main-program" title="Permalink to this headline">¶</a></h2>
<p>Before we dive into the details of the paratrooper, lets look at the main
program that controls them:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Paratrooper</span><span class="o">&gt;</span> <span class="n">troopers</span><span class="o">;</span>  <span class="c1">// initially null</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>

  <span class="c1">// make a new, initially empty, ArrayList of paratroopers</span>
  <span class="n">troopers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Paratrooper</span><span class="o">&gt;();</span>

  <span class="c1">// add some paratroopers</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">Paratrooper</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Paratrooper</span><span class="o">();</span>
     <span class="n">troopers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
     <span class="o">++</span><span class="n">i</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>

  <span class="k">for</span><span class="o">(</span><span class="n">Paratrooper</span> <span class="n">t</span> <span class="o">:</span> <span class="n">troopers</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">render</span><span class="o">();</span>
    <span class="n">t</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>We define a variable of type <code class="docutils literal"><span class="pre">ArrayList&lt;Paratrooper&gt;</span></code>, and then in <code class="docutils literal"><span class="pre">setup</span></code>
assign a new (initially empty) <code class="docutils literal"><span class="pre">ArrayList&lt;Paratrooper&gt;</span></code> object to it. Then
we add some paratroopers to <code class="docutils literal"><span class="pre">trooper</span></code> using a while loop. Inside <code class="docutils literal"><span class="pre">draw</span></code>,
after making the screen white, we then call <code class="docutils literal"><span class="pre">render</span></code> and <code class="docutils literal"><span class="pre">update</span></code> on each
<code class="docutils literal"><span class="pre">Paratrooper</span></code> object in <code class="docutils literal"><span class="pre">trooper</span></code>.</p>
</div>
<div class="section" id="the-paratrooper-class">
<h2>The Paratrooper Class<a class="headerlink" href="#the-paratrooper-class" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">Paratropper</span></code> class has this overall structure:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">class</span> <span class="nc">Paratrooper</span> <span class="o">{</span>

  <span class="c1">// ... variables for this Paratrooper ...</span>

  <span class="n">Paratrooper</span><span class="o">()</span> <span class="o">{</span>  <span class="c1">// constructor</span>
    <span class="c1">// ...  initializes variables ...</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">render</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ... drawing code ...</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ... updates the variables of the paratrooper object ...</span>
  <span class="o">}</span>

<span class="o">}</span> <span class="c1">// class Paratrooper</span>
</pre></div>
</div>
<p>Lets start by defining the variables. We want:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code>, to store the position of the paratrooper.</li>
<li><code class="docutils literal"><span class="pre">fallingSpeed</span></code>, to store the speed at which a &#8220;falling&#8221; paratrooper falls.</li>
<li><code class="docutils literal"><span class="pre">walkingSpeed</span></code>, to store the speed at which a &#8220;walking&#8221; paratrooper walks.</li>
<li><code class="docutils literal"><span class="pre">drag</span></code>, which will be used to calculate the speed of a <code class="docutils literal"><span class="pre">floating</span></code>
paratrooper. A paratrooper will float downwards at speed <code class="docutils literal"><span class="pre">drag</span> <span class="pre">*</span>
<span class="pre">fallingSpeed</span></code>, and so <code class="docutils literal"><span class="pre">drag</span></code> should be some value between 0 and 1.</li>
<li><code class="docutils literal"><span class="pre">chuteOpenHeight</span></code>, to store the height along the y-axis for when a
paratrooper&#8217;s chute should open up.</li>
<li><code class="docutils literal"><span class="pre">bodyColor</span></code>, to store the color of the paratrooper&#8217;s body (which we&#8217;ll
draw as a rectangle).</li>
<li><code class="docutils literal"><span class="pre">state</span></code>, to store the current state of the paratrooper. The possible
values of <code class="docutils literal"><span class="pre">state</span></code> are the strings <code class="docutils literal"><span class="pre">&quot;falling&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;floating&quot;</span></code>, and
<code class="docutils literal"><span class="pre">&quot;walking&quot;</span></code>.</li>
</ul>
<p>Of course, you could add other variables if we wanted to make a more detailed
paratrooper.</p>
<p>Now lets add those variables to the class, and initialize them in the
constructor:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">class</span> <span class="nc">Paratrooper</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">fallingSpeed</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">walkingSpeed</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">drag</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">chuteOpenHeight</span><span class="o">;</span>
  <span class="n">color</span> <span class="n">bodyColor</span><span class="o">;</span>

  <span class="n">String</span> <span class="n">state</span><span class="o">;</span> <span class="c1">// &quot;falling&quot;, &quot;floating&quot;, or &quot;walking&quot;</span>

  <span class="n">Paratrooper</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">450</span><span class="o">);</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">drag</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mf">0.02</span><span class="o">,</span> <span class="mf">0.08</span><span class="o">);</span>
    <span class="n">chuteOpenHeight</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">350</span><span class="o">);</span>
    <span class="n">fallingSpeed</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mf">3.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">);</span>
    <span class="n">bodyColor</span> <span class="o">=</span> <span class="n">color</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mi">256</span><span class="o">),</span> <span class="n">random</span><span class="o">(</span><span class="mi">256</span><span class="o">),</span> <span class="n">random</span><span class="o">(</span><span class="mi">256</span><span class="o">));</span>
    <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;falling&quot;</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">render</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

<span class="o">}</span> <span class="c1">// class Paratrooper</span>
</pre></div>
</div>
<p>Notice that we initialize <code class="docutils literal"><span class="pre">state</span></code> to the value <code class="docutils literal"><span class="pre">&quot;falling&quot;</span></code>, which means
that paratroopers will start out falling from the top of the screen.</p>
<p>Now lets create the <code class="docutils literal"><span class="pre">render()</span></code> function. It will have this general
structure:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">render</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">pushMatrix</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;falling&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;floating&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;walking&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span>
    <span class="n">popMatrix</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>As usual, we call <code class="docutils literal"><span class="pre">pushMatrix()</span></code> at the start of <code class="docutils literal"><span class="pre">render()</span></code> to save the
current coordinate system. The call <code class="docutils literal"><span class="pre">popMatrix()</span></code> at the end restores this
saved coordinate system.</p>
<p>Between <code class="docutils literal"><span class="pre">pushMatrix()</span></code> and <code class="docutils literal"><span class="pre">popMatrix()</span></code> we have a big if-else-if
structure that does different things depending upon the value of <code class="docutils literal"><span class="pre">state</span></code>.
Lets list the different things we want to draw:</p>
<ul class="simple">
<li>When <code class="docutils literal"><span class="pre">state</span></code> is &#8220;falling&#8221;, we&#8217;ll draw just a colored rectangle.</li>
<li>When <code class="docutils literal"><span class="pre">state</span></code> is &#8220;floating&#8221;, we&#8217;ll draw the colored rectangle plus a
parachute on top.</li>
<li>When <code class="docutils literal"><span class="pre">state</span></code> is &#8220;walking&#8221;, we&#8217;ll draw just a colored rectangle.</li>
</ul>
<p>Of course, you can make much more elaborate drawings than this if you have the
time and interest.</p>
<p>Here&#8217;s the full implementation of <code class="docutils literal"><span class="pre">render()</span></code>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">render</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">pushMatrix</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;falling&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">translate</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
      <span class="n">fill</span><span class="o">(</span><span class="n">bodyColor</span><span class="o">);</span>
      <span class="n">noStroke</span><span class="o">();</span>
      <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;floating&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">translate</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
      <span class="n">fill</span><span class="o">(</span><span class="n">bodyColor</span><span class="o">);</span>
      <span class="n">noStroke</span><span class="o">();</span>
      <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span> <span class="c1">// body</span>

      <span class="n">fill</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="mi">200</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
      <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="n">arc</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="n">PI</span><span class="o">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">);</span>
      <span class="n">line</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mi">8</span><span class="o">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">);</span>
      <span class="n">line</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;walking&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">translate</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
      <span class="n">fill</span><span class="o">(</span><span class="n">bodyColor</span><span class="o">);</span>
      <span class="n">noStroke</span><span class="o">();</span>
      <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">popMatrix</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The only tricky thing here is how <code class="docutils literal"><span class="pre">arc</span></code> is used to draw a half-circle that
looks like a parachute.</p>
<p>The <code class="docutils literal"><span class="pre">update()</span></code> function has a similar overall structure:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;falling&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;floating&quot;</span><span class="o">))</span> <span class="o">{</span>
     <span class="c1">// ...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;walking&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>There&#8217;s no need to call <code class="docutils literal"><span class="pre">pushMatrix()</span></code> and <code class="docutils literal"><span class="pre">popMatrix()</span></code> for <code class="docutils literal"><span class="pre">update()</span></code>
because it will not (should not!) be changing the screen coordinate system.</p>
<p>Let&#8217;s list the things we need to do for each state in <code class="docutils literal"><span class="pre">update()</span></code>:</p>
<ul class="simple">
<li>When <code class="docutils literal"><span class="pre">state</span></code> is &#8220;falling&#8221;, we need to increment <code class="docutils literal"><span class="pre">y</span></code> by <code class="docutils literal"><span class="pre">fallingSpeed</span></code>.
Also, we need to check if <code class="docutils literal"><span class="pre">y</span> <span class="pre">&gt;=</span> <span class="pre">chuteOpenHeight</span></code>. If it is, then we will
set <code class="docutils literal"><span class="pre">state</span></code> to &#8220;floating&#8221;.</li>
<li>When <code class="docutils literal"><span class="pre">state</span></code> is &#8220;floating&#8221;, we increment <code class="docutils literal"><span class="pre">y</span></code> by <code class="docutils literal"><span class="pre">drag</span> <span class="pre">*</span> <span class="pre">fallingSpeed</span></code>.
Also, we check to see if <code class="docutils literal"><span class="pre">y</span> <span class="pre">&gt;=</span> <span class="pre">490</span></code>, i.e. if the paratrooper has reached
the bottom of the screen. If <code class="docutils literal"><span class="pre">y</span> <span class="pre">&gt;=</span>&nbsp; <span class="pre">490</span></code> is true, then we do this:<ul>
<li>Set <code class="docutils literal"><span class="pre">state</span></code> to &#8220;walking&#8221;.</li>
<li>Assign a value to <code class="docutils literal"><span class="pre">walkingSpeed</span></code> chosen at random from a small range of
numbers.</li>
</ul>
</li>
<li>When <code class="docutils literal"><span class="pre">state</span></code> is walking, we increment <code class="docutils literal"><span class="pre">x</span></code> (not <code class="docutils literal"><span class="pre">y</span></code>!) by
<code class="docutils literal"><span class="pre">walkingSpeed</span></code>. Also, we check to see if the paratrooper has reached an
edge of the screen, i.e. if <code class="docutils literal"><span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">0</span></code> or <code class="docutils literal"><span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">500</span></code>. If so, then we do
this:<ul>
<li>Set <code class="docutils literal"><span class="pre">state</span></code> to &#8220;falling&#8221;.</li>
<li>Set <code class="docutils literal"><span class="pre">x</span></code> to be a random number in the range 50 to 450.</li>
<li>Set <code class="docutils literal"><span class="pre">y</span></code> to be 0 (so it will start falling from the top of the screen).</li>
</ul>
</li>
</ul>
<p>Here&#8217;s the entire implementation of <code class="docutils literal"><span class="pre">update()</span></code>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;falling&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">y</span> <span class="o">+=</span> <span class="n">fallingSpeed</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">chuteOpenHeight</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;floating&quot;</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;floating&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">y</span> <span class="o">+=</span> <span class="n">drag</span> <span class="o">*</span> <span class="n">fallingSpeed</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">490</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;walking&quot;</span><span class="o">;</span>
        <span class="n">walkingSpeed</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mf">0.5</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">walkingSpeed</span> <span class="o">=</span> <span class="o">-</span><span class="n">walkingSpeed</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;walking&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">walkingSpeed</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;falling&quot;</span><span class="o">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">450</span><span class="o">);</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Take a look at this code:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">walkingSpeed</span> <span class="o">=</span> <span class="o">-</span><span class="n">walkingSpeed</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal"><span class="pre">random(0,</span> <span class="pre">1.0)</span></code> returns a randomly chosen number in the
range 0 to 1, and to the express <code class="docutils literal"><span class="pre">random(0,</span> <span class="pre">1.0)</span> <span class="pre">&lt;</span> <span class="pre">0.5</span></code> is true
approximately 50% of the time. It is like a coin-flip: half the time
<code class="docutils literal"><span class="pre">walkingSpeed</span></code> will negated, while the rest of the time it won&#8217;t.</p>
</div>
<div class="section" id="a-note-on-efficiency">
<h2>A Note on Efficiency<a class="headerlink" href="#a-note-on-efficiency" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ve implemented <code class="docutils literal"><span class="pre">state</span></code> as a <code class="docutils literal"><span class="pre">String</span></code> variable so that it is easy to
keep track of the current state. However, testing if two strings are equal
usually requires more work than checking if, say, two <code class="docutils literal"><span class="pre">int</span></code> values are
equal. If you only have a few animated objects on the screen at once, then
using <code class="docutils literal"><span class="pre">String</span></code> for <code class="docutils literal"><span class="pre">state</span></code> probably doesn&#8217;t make any noticeable
difference. However, for program with lots and lots of animated objects, it
could be a problem.</p>
<p>To increase the speed of checking <code class="docutils literal"><span class="pre">state</span></code>, there are a couple of common
approaches:</p>
<ul>
<li><p class="first">Make <code class="docutils literal"><span class="pre">state</span></code> of type <code class="docutils literal"><span class="pre">int</span></code>, and use numbers to represent states. For
example, &#8220;falling&#8221; could be 1, &#8220;floating&#8221; 2, and &#8220;walking&#8221; 3. Programmers
often define variables to remember what number each state is, e.g.:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">final</span> <span class="kt">int</span> <span class="n">FALLING</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="kd">final</span> <span class="kt">int</span> <span class="n">FLOATING</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
<span class="kd">final</span> <span class="kt">int</span> <span class="n">WALKING</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
</pre></div>
</div>
<p>The keyword <code class="docutils literal"><span class="pre">final</span></code> means that these variables cannot be changed later in
the program &#8212; they are constants.</p>
<p>We can then write code like this:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">FALLING</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">FLOATING</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">WALKING</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">==</span></code> is usually more efficient then <code class="docutils literal"><span class="pre">equals</span></code>, so this could be somewhat
faster code.</p>
</li>
<li><p class="first">Use an <a class="reference external" href="http://docs.oracle.com/javase/tutorial/java/javaOO/enum.html">enum</a>. An
<code class="docutils literal"><span class="pre">enum</span></code> is essentially a built-in version of the previous idea that is
safe, readable, and efficient.</p>
</li>
</ul>
</div>
<div class="section" id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Add another state to the paratroopers called &#8220;waiting&#8221; which causes them to
wait for a short, random amount of time after they land on the ground.
After they finish waiting, they should start walking.</li>
<li>Instead of having the paratroopers just appear falling on the screen, add
an airplane that continually flies across the top of the screen, dropping
the paratroopers as it goes.</li>
</ol>
</div>
<div class="section" id="source-code">
<h2>Source Code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Paratrooper</span><span class="o">&gt;</span> <span class="n">troopers</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>

  <span class="n">troopers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Paratrooper</span><span class="o">&gt;();</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">troopers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Paratrooper</span><span class="o">());</span>
     <span class="o">++</span><span class="n">i</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>

  <span class="k">for</span><span class="o">(</span><span class="n">Paratrooper</span> <span class="n">t</span> <span class="o">:</span> <span class="n">troopers</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">render</span><span class="o">();</span>
    <span class="n">t</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">Paratrooper</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">fallingSpeed</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">walkingSpeed</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">drag</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">chuteOpenHeight</span><span class="o">;</span>
  <span class="n">color</span> <span class="n">bodyColor</span><span class="o">;</span>

  <span class="n">String</span> <span class="n">state</span><span class="o">;</span> <span class="c1">// falling&quot;, &quot;floating&quot;, or &quot;walking&quot;</span>

  <span class="n">Paratrooper</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">450</span><span class="o">);</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">drag</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mf">0.02</span><span class="o">,</span> <span class="mf">0.08</span><span class="o">);</span>
    <span class="n">chuteOpenHeight</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">350</span><span class="o">);</span>
    <span class="n">fallingSpeed</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mf">3.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">);</span>
    <span class="n">bodyColor</span> <span class="o">=</span> <span class="n">color</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mi">256</span><span class="o">),</span> <span class="n">random</span><span class="o">(</span><span class="mi">256</span><span class="o">),</span> <span class="n">random</span><span class="o">(</span><span class="mi">256</span><span class="o">));</span>
    <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;falling&quot;</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">render</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">pushMatrix</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;falling&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">translate</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
      <span class="n">fill</span><span class="o">(</span><span class="n">bodyColor</span><span class="o">);</span>
      <span class="n">noStroke</span><span class="o">();</span>
      <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;floating&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">translate</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
      <span class="n">fill</span><span class="o">(</span><span class="n">bodyColor</span><span class="o">);</span>
      <span class="n">noStroke</span><span class="o">();</span>
      <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span> <span class="c1">// body</span>

      <span class="n">fill</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="mi">200</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
      <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="n">arc</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="n">PI</span><span class="o">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">);</span>
      <span class="n">line</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mi">8</span><span class="o">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">);</span>
      <span class="n">line</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;walking&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">translate</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
      <span class="n">fill</span><span class="o">(</span><span class="n">bodyColor</span><span class="o">);</span>
      <span class="n">noStroke</span><span class="o">();</span>
      <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">popMatrix</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;falling&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">y</span> <span class="o">+=</span> <span class="n">fallingSpeed</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">chuteOpenHeight</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;floating&quot;</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;floating&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">y</span> <span class="o">+=</span> <span class="n">drag</span> <span class="o">*</span> <span class="n">fallingSpeed</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">490</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;walking&quot;</span><span class="o">;</span>
        <span class="n">walkingSpeed</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mf">0.5</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">walkingSpeed</span> <span class="o">=</span> <span class="o">-</span><span class="n">walkingSpeed</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;walking&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">walkingSpeed</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;falling&quot;</span><span class="o">;</span>
        <span class="n">randomRestart</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span> <span class="c1">// class Paratrooper</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="grass.html" title="Case Study: Watching Grass Grow"
             >next</a> |</li>
        <li class="right" >
          <a href="sprite_water_sim.html" title="Simulating Water with a Particle System"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CMPT 166 Fall 2016 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Toby Donaldson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>