<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Special Effect: Dragging and Dropping &mdash; CMPT 166 Fall 2016 1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="CMPT 166 Fall 2016 1 documentation" href="index.html" />
    <link rel="next" title="Strings" href="strings_and_chars.html" />
    <link rel="prev" title="Hit Detection and Functions" href="hit_detection.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="strings_and_chars.html" title="Strings"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="hit_detection.html" title="Hit Detection and Functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CMPT 166 Fall 2016 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Special Effect: Dragging and Dropping</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#planning-the-program">Planning the Program</a></li>
<li><a class="reference internal" href="#the-program">The Program</a></li>
<li><a class="reference internal" href="#a-small-problem">A Small Problem</a></li>
<li><a class="reference internal" href="#simulating-pmousex-and-pmousey-ourselves">Simulating pmouseX and pmouseY Ourselves</a></li>
<li><a class="reference internal" href="#questions">Questions</a></li>
<li><a class="reference internal" href="#programming-questions">Programming Questions</a></li>
<li><a class="reference internal" href="#sample-program">Sample Program</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="hit_detection.html"
                        title="previous chapter">Hit Detection and Functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="strings_and_chars.html"
                        title="next chapter">Strings</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="special-effect-dragging-and-dropping">
<h1>Special Effect: Dragging and Dropping<a class="headerlink" href="#special-effect-dragging-and-dropping" title="Permalink to this headline">¶</a></h1>
<p>In these notes you will learn:</p>
<ul class="simple">
<li>How to implement drag-and-drop using the <code class="docutils literal"><span class="pre">mouseDragged</span></code> function.</li>
<li>How to drag an object while keeping the mouse pointer fixed on the
drag point.</li>
</ul>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>A standard user interface effect is &#8220;dragging&#8221; an object around the screen by
clicking and holding it. For example, in a window interface you can delete a
file by dragging its icon into a trash bin. In this note we will see how to
implement basic drag-and-drop in <a class="reference external" href="http://processing.org/">Processing</a>.</p>
</div>
<div class="section" id="planning-the-program">
<h2>Planning the Program<a class="headerlink" href="#planning-the-program" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s write a program that lets the user drag a ball around the screen. To be
clear, let&#8217;s say exactly what we mean by dragging and dropping. Dragging means
that the user clicks the mouse pointer somewhere on the ball and then, while
still holding the mouse button down, moves the mouse. As the mouse moves, the
circle moves. The &#8220;dropping&#8221; part occurs when the user releases the mouse
button, and the circle detaches from the pointer and stays where it is.</p>
<p>Dragging and dropping is such a common operation that <a class="reference external" href="http://processing.org/">Processing</a> provides the
special <code class="docutils literal"><span class="pre">mouseDragged()</span></code> function to handle it. This function is
automatically called when the user &#8220;clicks and holds&#8221; the mouse, i.e. when
they do a drag-and-drop action.</p>
</div>
<div class="section" id="the-program">
<h2>The Program<a class="headerlink" href="#the-program" title="Permalink to this headline">¶</a></h2>
<p id="drag-and-drop-prog-label">Here is our first drag-and-drop program:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">class</span> <span class="nc">Sprite</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">x</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">y</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">dx</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">dy</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">Sprite</span> <span class="n">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sprite</span><span class="o">();</span>
<span class="kt">float</span> <span class="n">diam</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>
  <span class="n">smooth</span><span class="o">();</span>
  <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">250</span><span class="o">;</span>
  <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">250</span><span class="o">;</span>
  <span class="n">diam</span> <span class="o">=</span> <span class="mi">125</span><span class="o">;</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>
  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
  <span class="n">ellipse</span><span class="o">(</span><span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span><span class="o">,</span> <span class="n">diam</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">mouseX</span><span class="o">;</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">mouseY</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">boolean</span> <span class="nf">pointInCircle</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">a</span><span class="o">,</span> <span class="kt">float</span> <span class="n">b</span><span class="o">,</span> <span class="kt">float</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">dist</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a-small-problem">
<h2>A Small Problem<a class="headerlink" href="#a-small-problem" title="Permalink to this headline">¶</a></h2>
<p>You may have noticed when playing with the previous program that if you click
near the edge of the circle, then its center immediately jumps to the mouse
pointer location. It seems unnatural and is the sort of small blemish that
makes a program look unpolished.</p>
<p>Suppose we don&#8217;t want that initial jump, and instead want the dragging to
happen smoothly for the entire time it&#8217;s being dragged. How can we make this
work? Let&#8217;s first try to understand why that jump is happening. Look at the
<code class="docutils literal"><span class="pre">mouseDragged()</span></code> function</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">mouseX</span><span class="o">;</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">mouseY</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When we drag the mouse on the ball, this function is called and it sets the
the ball&#8217;s center to (<code class="docutils literal"><span class="pre">mouseX</span></code>, <code class="docutils literal"><span class="pre">mouseY</span></code>). The <em>first</em> time this is done
is when the jump may occur: if the mouse pointer happens to start dragging
near the ball&#8217;s edge, then, in the next frame of animation, the ball&#8217;s center
jumps to the mouse location.</p>
<p>How can we fix this? Imagine we&#8217;ve just started dragging the ball with the
mouse pointer near its edge. Suppose, in one frame, the mouse moves 3 pixels
down, and 2 pixels to the right. What we want is for the center of the ball to
move 3 pixels down, and 2 pixels right. In other words, instead of setting the
center to be the location of the mouse pointer, we want the center to also
move down and to the right, mimicking the mouse movement. We can do this by
adding 3 pixels to <code class="docutils literal"><span class="pre">y</span></code> and add 2 pixels to <code class="docutils literal"><span class="pre">x</span></code>.</p>
<p>To figure out the distance to move the ball&#8217;s center, we&#8217;ll use the special
<a class="reference external" href="http://processing.org/">Processing</a> variables <code class="docutils literal"><span class="pre">pmouseX</span></code> and <code class="docutils literal"><span class="pre">pmouseY</span></code>. The point (<code class="docutils literal"><span class="pre">pmouseX</span></code>,
<code class="docutils literal"><span class="pre">pmouseY</span></code>) is the location of the mouse pointer in the <em>previous</em> call to
<code class="docutils literal"><span class="pre">draw()</span></code>. Since the mouse pointer is at (<code class="docutils literal"><span class="pre">mouseX</span></code>, <code class="docutils literal"><span class="pre">mouseY</span></code>) in the
current call to <code class="docutils literal"><span class="pre">draw()</span></code>, the distance the mouse pointer moved is <code class="docutils literal"><span class="pre">mouseX</span> <span class="pre">-</span>
<span class="pre">pmouseX</span></code> in the direction of the x-axis, and <code class="docutils literal"><span class="pre">mouseY</span> <span class="pre">-</span> <span class="pre">pmouseY</span></code> in the
direction of the y-axis.</p>
<p>In code we get this:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">mouseX</span> <span class="o">-</span> <span class="n">pmouseX</span><span class="o">;</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="n">mouseY</span> <span class="o">-</span> <span class="n">pmouseY</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Here is the full program:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">class</span> <span class="nc">Sprite</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">x</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">y</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">dx</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">dy</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">Sprite</span> <span class="n">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sprite</span><span class="o">();</span>
<span class="kt">float</span> <span class="n">diam</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>
  <span class="n">smooth</span><span class="o">();</span>
  <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">250</span><span class="o">;</span>
  <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">250</span><span class="o">;</span>
  <span class="n">diam</span> <span class="o">=</span> <span class="mi">125</span><span class="o">;</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>
  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
  <span class="n">ellipse</span><span class="o">(</span><span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span><span class="o">,</span> <span class="n">diam</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">mouseX</span> <span class="o">-</span> <span class="n">pmouseX</span><span class="o">;</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="n">mouseY</span> <span class="o">-</span> <span class="n">pmouseY</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">boolean</span> <span class="nf">pointInCircle</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">a</span><span class="o">,</span> <span class="kt">float</span> <span class="n">b</span><span class="o">,</span> <span class="kt">float</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">dist</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="simulating-pmousex-and-pmousey-ourselves">
<h2>Simulating pmouseX and pmouseY Ourselves<a class="headerlink" href="#simulating-pmousex-and-pmousey-ourselves" title="Permalink to this headline">¶</a></h2>
<p>If <a class="reference external" href="http://processing.org/">Processing</a> didn&#8217;t already provide us with <code class="docutils literal"><span class="pre">pmouseX</span></code> and <code class="docutils literal"><span class="pre">pmouseY</span></code>,
then we could create our own versions of those variables ourselves like this:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// ... Sprite class as before ...</span>

<span class="n">Sprite</span> <span class="n">ball</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sprite</span><span class="o">();</span>
<span class="kt">float</span> <span class="n">diam</span><span class="o">;</span>

<span class="kt">float</span> <span class="n">prevMouseX</span><span class="o">;</span>  <span class="c1">// these are both automatically initialized</span>
<span class="kt">float</span> <span class="n">prevMouseY</span><span class="o">;</span>  <span class="c1">// to 0.0</span>

<span class="c1">// ...</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// ... code as before</span>

  <span class="n">prevMouseX</span> <span class="o">=</span> <span class="n">mouseX</span><span class="o">;</span>  <span class="c1">// remember the current values of</span>
  <span class="n">prevMouseY</span> <span class="o">=</span> <span class="n">mouseY</span><span class="o">;</span>  <span class="c1">// mouseX and mouseY</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">mouseX</span> <span class="o">-</span> <span class="n">prevMouseX</span><span class="o">;</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="n">mouseY</span> <span class="o">-</span> <span class="n">prevMouseY</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Unfortunately, this <strong>doesn&#8217;t work</strong>! At a glance, it seems that everything
makes sense. Both <code class="docutils literal"><span class="pre">prevMouseX</span></code> and <code class="docutils literal"><span class="pre">preMouseY</span></code> are defined properly, they
get assigned <code class="docutils literal"><span class="pre">mouseX</span></code> and <code class="docutils literal"><span class="pre">mouseY</span></code> in <code class="docutils literal"><span class="pre">draw()</span></code>, and they are used
properly in <code class="docutils literal"><span class="pre">mouseDragged</span></code>. But try running the program with these changes,
and you&#8217;ll soon see the circle and mouse pointer are moving differently.</p>
<p>So what&#8217;s the problem? It is not at all obvious why it&#8217;s different from when
we used <code class="docutils literal"><span class="pre">pmouseX</span></code> and <code class="docutils literal"><span class="pre">pmouseY</span></code>. One thing we could do is to read <a class="reference external" href="http://www.hknowstore.com/">the
documentation for pmouseX</a> to see if it says
anything relevant. And indeed it does: the second paragraph of the description
of <code class="docutils literal"><span class="pre">pmouseX</span></code> is this:</p>
<blockquote>
<div>You may find that <code class="docutils literal"><span class="pre">pmouseX</span></code> and <code class="docutils literal"><span class="pre">pmouseY</span></code> have different values when
referenced inside of <code class="docutils literal"><span class="pre">draw()</span></code> and inside of mouse events like
<code class="docutils literal"><span class="pre">mousePressed()</span></code> and mouseMoved(). Inside <code class="docutils literal"><span class="pre">draw()</span></code>, <code class="docutils literal"><span class="pre">mouseX</span></code> and
<code class="docutils literal"><span class="pre">pmouseY</span></code> update only once per frame (once per trip through the
<code class="docutils literal"><span class="pre">draw()</span></code> loop). But inside mouse events, they update each time the event
is called. If these values weren&#8217;t updated immediately during mouse
events, then the mouse position would be read only once per frame,
resulting in slight delays and choppy interaction. If the mouse variables
were always updated multiple times per frame, then something like
<code class="docutils literal"><span class="pre">line(pmouseX,</span> <span class="pre">pmouseY,</span> <span class="pre">mouseX,</span> <span class="pre">mouseY)</span></code> inside <code class="docutils literal"><span class="pre">draw()</span></code> would have
lots of gaps, because <code class="docutils literal"><span class="pre">pmouseX</span></code> may have changed several times in
between the calls to <code class="docutils literal"><span class="pre">line()</span></code>.</div></blockquote>
<p>What this tells is that we also need to update <code class="docutils literal"><span class="pre">prevMouseX</span></code> and
<code class="docutils literal"><span class="pre">prevMouseY</span></code> and the end of <code class="docutils literal"><span class="pre">mouseDragged</span></code> like this:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">ball</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">diam</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">mouseX</span> <span class="o">-</span> <span class="n">prevMouseX</span><span class="o">;</span>
    <span class="n">ball</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="n">mouseY</span> <span class="o">-</span> <span class="n">prevMouseY</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">prevMouseX</span> <span class="o">=</span> <span class="n">mouseX</span><span class="o">;</span>  <span class="c1">// remember the current values of</span>
  <span class="n">prevMouseY</span> <span class="o">=</span> <span class="n">mouseY</span><span class="o">;</span>  <span class="c1">// mouseX and mouseY</span>
<span class="o">}</span>
</pre></div>
</div>
<p>With this addition, the program works properly.</p>
<p>Notice that the fix is simple: we just added two statements to the end of
<code class="docutils literal"><span class="pre">mouseDragged()</span></code>. What was hard was figuring out <em>what</em> to do. In general,
there&#8217;s no easy recipe to follow for debugging a program. Every bug is
different, and with more experience and knowledge of <a class="reference external" href="http://processing.org/">Processing</a> you will get
better at it.</p>
</div>
<div class="section" id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Write an explanation of dragging-and-dropping that a smart but computer
illiterate grandpa could understand.</li>
<li>When is the <code class="docutils literal"><span class="pre">mouseDragged()</span></code> function called?</li>
<li>Explain the variables <code class="docutils literal"><span class="pre">pmouseX</span></code> and <code class="docutils literal"><span class="pre">pmouseY</span></code>.</li>
</ol>
</div>
<div class="section" id="programming-questions">
<h2>Programming Questions<a class="headerlink" href="#programming-questions" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Modify <a class="reference internal" href="#drag-and-drop-prog-label"><span>the drag-and-drop program</span></a> so that
<em>two</em> differently-colored circles can be dragged and dropped around the
screen. Set the transparency of the circles so that it is impossible for
one of the circles to completely hide the other.</li>
<li>Modify <a class="reference internal" href="#drag-and-drop-prog-label"><span>the drag-and-drop program</span></a> so that
it is <em>impossible</em> for any portion of the circle to go off the screen.
However, edges of the circle should be able to touch the edges of the
screen. <strong>Hint</strong>: Read about the <a class="reference external" href="http://processing.org/">Processing</a> <a class="reference external" href="http://processing.org/reference/constrain_.html">constrain function</a>.</li>
<li>Write a program that lets a user drag-and-drop a rectangle around the
screen. Make sure that the mouse pointer stays on the point that is first
clicked while the rectangle is being dragged.</li>
</ol>
</div>
<div class="section" id="sample-program">
<h2>Sample Program<a class="headerlink" href="#sample-program" title="Permalink to this headline">¶</a></h2>
<p>The following program combines a number of the programming features we&#8217;ve
learned so far. It draws a red and a green ball, and a red and a green
rectangle. When the red ball is moved onto the red rectangle, and the red
rectangle is moved onto the green rectangle, the rectangles &#8220;fly&#8221; away.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">class</span> <span class="nc">Sprite</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">x</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">y</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">dx</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">dy</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">Sprite</span> <span class="n">redBall</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sprite</span><span class="o">();</span>
<span class="n">Sprite</span> <span class="n">greenBall</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sprite</span><span class="o">();</span>

<span class="n">Sprite</span> <span class="n">redRect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sprite</span><span class="o">();</span>
<span class="n">Sprite</span> <span class="n">greenRect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sprite</span><span class="o">();</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>

  <span class="c1">// randomly place the red ball on the left half of the screen</span>
  <span class="n">redBall</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
  <span class="n">redBall</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">450</span><span class="o">);</span>

  <span class="c1">// randomly place the green ball on the right half of the screen</span>
  <span class="n">greenBall</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">450</span><span class="o">);</span>
  <span class="n">greenBall</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">450</span><span class="o">);</span>

  <span class="c1">// right half of the screen is red</span>
  <span class="n">redRect</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">250</span><span class="o">;</span>
  <span class="n">redRect</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

  <span class="c1">// left half of the screen is green</span>
  <span class="n">greenRect</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="n">greenRect</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>

  <span class="c1">// red rectangle</span>
  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
  <span class="n">rect</span><span class="o">(</span><span class="n">redRect</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">redRect</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">250</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>

  <span class="c1">// green rectangle</span>
  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
  <span class="n">rect</span><span class="o">(</span><span class="n">greenRect</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">greenRect</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">250</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>

  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
  <span class="n">ellipse</span><span class="o">(</span><span class="n">redBall</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">redBall</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>

  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
  <span class="n">ellipse</span><span class="o">(</span><span class="n">greenBall</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">greenBall</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>

  <span class="n">checkGameOver</span><span class="o">();</span>

  <span class="n">redBall</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">redBall</span><span class="o">.</span><span class="na">dx</span><span class="o">;</span>
  <span class="n">greenBall</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">greenBall</span><span class="o">.</span><span class="na">dx</span><span class="o">;</span>

  <span class="n">redRect</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">redRect</span><span class="o">.</span><span class="na">dx</span><span class="o">;</span>
  <span class="n">greenRect</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="n">greenRect</span><span class="o">.</span><span class="na">dy</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// you win when the red ball is on the right half</span>
<span class="c1">// of the screen, and the green ball is on the left half</span>
<span class="kt">void</span> <span class="nf">checkGameOver</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span> <span class="n">pointInRect</span><span class="o">(</span><span class="n">redBall</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">redBall</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">250</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">250</span><span class="o">,</span> <span class="mi">500</span><span class="o">)</span>
    <span class="o">&amp;&amp;</span> <span class="n">pointInRect</span><span class="o">(</span><span class="n">greenBall</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">greenBall</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">250</span><span class="o">,</span> <span class="mi">500</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">redRect</span><span class="o">.</span><span class="na">dx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">;</span>
      <span class="n">greenRect</span><span class="o">.</span><span class="na">dy</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">redBall</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">redBall</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">25</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">redBall</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">mouseX</span> <span class="o">-</span> <span class="n">pmouseX</span><span class="o">;</span>
    <span class="n">redBall</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="n">mouseY</span> <span class="o">-</span> <span class="n">pmouseY</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">pointInCircle</span><span class="o">(</span><span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">,</span> <span class="n">greenBall</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">greenBall</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="mi">25</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">greenBall</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="n">mouseX</span> <span class="o">-</span> <span class="n">pmouseX</span><span class="o">;</span>
    <span class="n">greenBall</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="n">mouseY</span> <span class="o">-</span> <span class="n">pmouseY</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">boolean</span> <span class="nf">pointInCircle</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">a</span><span class="o">,</span> <span class="kt">float</span> <span class="n">b</span><span class="o">,</span> <span class="kt">float</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">dist</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">boolean</span> <span class="nf">pointInRect</span><span class="o">(</span><span class="kt">float</span> <span class="n">a</span><span class="o">,</span> <span class="kt">float</span> <span class="n">b</span><span class="o">,</span> <span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">w</span><span class="o">,</span> <span class="kt">float</span> <span class="n">h</span><span class="o">)</span>
<span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">b</span> <span class="o">&gt;=</span> <span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="strings_and_chars.html" title="Strings"
             >next</a> |</li>
        <li class="right" >
          <a href="hit_detection.html" title="Hit Detection and Functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CMPT 166 Fall 2016 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Toby Donaldson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>